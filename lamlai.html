<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .highlight {
            background-color: yellow;
        }
    </style>
</head>

<body>
    <audio id="audioPlayer" controls></audio>
    <div id="transcript"></div>

    <script>
        const audioFilePath = './jameslan.ogg'; // Thay đổi đường dẫn file audio của bạn
        async function loadData() {
            try {
                const response = await fetch('/jameslan.json'); // Thay 'your_file.json' bằng tên file JSON của bạn
                const data = await response.json();

                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.src = audioFilePath;

                const transcriptDiv = document.getElementById('transcript');
                let wordElements = [];// Mảng để lưu trữ các phần tử span của từng từ
                // Tạo các phần tử span cho từng từ và thêm vào transcript
                data.dialog.forEach(item => {
                    const dialogDiv = document.createElement('div');//Tạo một div cho mỗi đoạn hội thoại
                    item.text.split(' ').forEach(word => { // Tách đoạn text thành các từ
                        const wordSpan = document.createElement('span');
                        wordSpan.textContent = word + ' ';// Thêm dấu cách để phân tách các từ
                        dialogDiv.appendChild(wordSpan);
                        wordElements.push(wordSpan);// Lưu trữ phần tử span vào mảng
                        console.log(wordElements);
                    });
                    transcriptDiv.appendChild(dialogDiv);
                });

                let currentWordIndex = 0;
                audioPlayer.addEventListener('timeupdate', function () {
                    const currentTime = audioPlayer.currentTime * 1000; // Chuyển đổi sang milliseconds

                    // Tìm từ hiện tại dựa trên timestamp
                    if (data.timestamp && currentWordIndex < data.timestamp.length) {
                        const timestamp = data.timestamp[currentWordIndex];
                        const startTime = timestamp[0];
                        const duration = timestamp[1];

                        console.log("currentTime:", currentTime);
                        console.log("startTime:", startTime);
                        console.log("duration:", duration);
                        console.log("currentWordIndex:", currentWordIndex);
                        console.log("word:", wordElements[currentWordIndex].textContent);
                        // Nếu thời gian hiện tại nằm trong khoảng thời gian của từ hiện tại
                        if (currentTime >= startTime && currentTime <= startTime + duration) {
                            // Loại bỏ highlight khỏi từ trước đó
                            if (currentWordIndex > 0) {
                                wordElements[currentWordIndex - 1].classList.remove('highlight');
                            }
                            // Highlight từ hiện tại
                            wordElements[currentWordIndex].classList.add('highlight');
                            currentWordIndex++; // Chuyển sang từ tiếp theo
                        }
                    }
                });
            } catch (error) {
                console.error('Có lỗi xảy ra:', error);
            }

        }

        loadData();
    </script>
</body>

</html>